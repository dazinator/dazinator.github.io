
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CRM / Plugin Generated Values - and Reducing Roundtrips! - Darrell Tunnell&#8217;s Blog</title>
  <meta name="author" content="Darrell Tunnell">

  
  <meta name="description" content="Just a short post this week, with a little CRM development pro tip for you! Scenario Say you have a plugin on the account entity that: Runs &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://darrelltunnell.net/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Darrell Tunnell's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-49278315-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Darrell Tunnell&#8217;s Blog</a></h1>
  
    <h2>Radiating Awesomeness, One Blog Post at a Time.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:darrelltunnell.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">CRM / Plugin Generated Values - and Reducing Roundtrips!</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-22T00:00:00+00:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Just a short post this week, with a little CRM development pro tip for you!</p>

<h2>Scenario</h2>

<p>Say you have a plugin on the <code>account</code> entity that:</p>

<ul>
<li>Runs synchronously on create</li>
<li>Generates a reference number for the account.</li>
</ul>


<p>Now assume we have an application that&rsquo;s on a seperate server to the CRM server (where latency and network traffic are a concern).</p>

<p>The application needs to:</p>

<ol>
<li>Create a contact in crm</li>
<li>Get the reference number that was generated for the contact.</li>
</ol>


<h2>The Multiple Roundtrip Way</h2>

<p>The most common way (the historical way) I have seen this dealt with is to do 2 seperate roundtrips with CRM:</p>

<ol>
<li>Create the account</li>
<li>Retrieve the account</li>
</ol>


<p>This obviously incurs the penalty of making two roundtrips with the server.</p>

<h2>The Pro Way!</h2>

<p>For quite some time now - as of <code>CRM 2011 Update Rollup 12 - (SDK 5.0.13)</code> you can utilise the <a href="http://msdn.microsoft.com/en-gb/library/jj863604(v=crm.5">Execute Multiple</a>.aspx) request to do this kind of thing in one roundtrip with the CRM server.</p>

<p>Here is an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'>                <span class="c1">// Create an ExecuteMultipleRequest object.</span>
</span><span class='line'>                <span class="kt">var</span> <span class="n">multipleRequests</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ExecuteMultipleRequest</span><span class="p">()</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="c1">// Assign settings that define execution behavior: continue on error, return responses. </span>
</span><span class='line'>                    <span class="n">Settings</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ExecuteMultipleSettings</span><span class="p">()</span>
</span><span class='line'>                    <span class="p">{</span>
</span><span class='line'>                        <span class="n">ContinueOnError</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
</span><span class='line'>                        <span class="n">ReturnResponses</span> <span class="p">=</span> <span class="k">true</span>
</span><span class='line'>                    <span class="p">},</span>
</span><span class='line'>                    <span class="c1">// Create an empty organization request collection.</span>
</span><span class='line'>                    <span class="n">Requests</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrganizationRequestCollection</span><span class="p">()</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>                <span class="kt">var</span> <span class="n">entity</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Entity</span><span class="p">(</span><span class="s">&quot;account&quot;</span><span class="p">);</span>
</span><span class='line'>                <span class="n">entity</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">();</span>
</span><span class='line'>                <span class="n">entity</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;experimental test&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">CreateRequest</span> <span class="n">createRequest</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CreateRequest</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">Target</span> <span class="p">=</span> <span class="n">entity</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">RetrieveRequest</span> <span class="n">retrieveRequest</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RetrieveRequest</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">Target</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EntityReference</span><span class="p">(</span><span class="n">entity</span><span class="p">.</span><span class="n">LogicalName</span><span class="p">,</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span>
</span><span class='line'>                    <span class="n">ColumnSet</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ColumnSet</span><span class="p">(</span><span class="s">&quot;createdon&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">multipleRequests</span><span class="p">.</span><span class="n">Requests</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">createRequest</span><span class="p">);</span>
</span><span class='line'>                <span class="n">multipleRequests</span><span class="p">.</span><span class="n">Requests</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">retrieveRequest</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// Execute all the requests in the request collection using a single web method call.</span>
</span><span class='line'>                <span class="n">ExecuteMultipleResponse</span> <span class="n">responseWithResults</span> <span class="p">=</span> <span class="p">(</span><span class="n">ExecuteMultipleResponse</span><span class="p">)</span><span class="n">orgService</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">multipleRequests</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>                <span class="kt">var</span> <span class="n">createResponseItem</span> <span class="p">=</span> <span class="n">responseWithResults</span><span class="p">.</span><span class="n">Responses</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
</span><span class='line'>                <span class="n">CreateResponse</span> <span class="n">createResponse</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">createResponseItem</span><span class="p">.</span><span class="n">Response</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">createResponse</span> <span class="p">=</span> <span class="p">(</span><span class="n">CreateResponse</span><span class="p">)</span><span class="n">createResponseItem</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>                <span class="kt">var</span> <span class="n">retrieveResponseItem</span> <span class="p">=</span> <span class="n">responseWithResults</span><span class="p">.</span><span class="n">Responses</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">RetrieveResponse</span> <span class="n">retrieveResponse</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="n">retrieveResponseItem</span><span class="p">.</span><span class="n">Response</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>                <span class="p">{</span>
</span><span class='line'>                    <span class="n">retrieveResponse</span> <span class="p">=</span> <span class="p">(</span><span class="n">RetrieveResponse</span><span class="p">)</span><span class="n">retrieveResponseItem</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>
</span><span class='line'>                <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="n">retrieveResponse</span><span class="p">.</span><span class="n">Entity</span><span class="p">[</span><span class="s">&quot;createdon&quot;</span><span class="p">]);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>What happened?</h2>

<p>Both the CreateRequest, and the RetrieveRequest (for the created entity) are batched up into a single Request and shipped off to the CRM server for processing.</p>

<p>CRM processed them in that order, collated the responses together, and returned them in a single batch.</p>

<h2>Caveats</h2>

<p>One caveat of this approach is that, if you intend to grab the generated values for an entity that is being created, then you need to know in advance what the ID will be.</p>

<p>This means you have to specify the ID of the entity when you create it.</p>

<p>For updates / deletes this isn&rsquo;t an issue, as the ID is allready known.</p>

<h2>Any SQL Guru&rsquo;s out there?</h2>

<p>Specifying your own ID&rsquo;s <em>might be a bad thing</em> if you don&rsquo;t use Sequential Guid&rsquo;s.
When CRM generates Id&rsquo;s, it generates them sequentially. I beleive there are SQL performance benefits to this in terms of index optimisation etc.</p>

<p>When you specify your own Id&rsquo;s, if you don&rsquo;t specify them sequentially, i.e  Guid.NewGuid(), this could well have a negative overhead on the DB - that&rsquo;s purely my suspicion - I am no SQL expert, - I&rsquo;d love to see someone look into that further!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Darrell Tunnell</span></span>

      




<time class='entry-date' datetime='2014-12-22T00:00:00+00:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/crm/'>crm</a>, <a class='category' href='/blog/categories/dynamics/'>dynamics</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://darrelltunnell.net/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips/" data-via="dazinate" data-counturl="http://darrelltunnell.net/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/12/14/unit-testing-crm-plugins/" title="Previous Post: Unit Testing Dynamics CRM Plugins">&laquo; Unit Testing Dynamics CRM Plugins</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips/">CRM / Plugin Generated Values - and Reducing Roundtrips!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/14/unit-testing-crm-plugins/">Unit Testing Dynamics CRM Plugins</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/16/a-proclamation/">A Proclamation</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dazinator">@dazinator</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dazinator',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/darrelltunnell?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Darrell Tunnell -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'darrelltunnellsblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://darrelltunnell.net/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips/';
        var disqus_url = 'http://darrelltunnell.net/blog/2014/12/22/crm-plugin-generated-values-and-reducing-roundtrips/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
